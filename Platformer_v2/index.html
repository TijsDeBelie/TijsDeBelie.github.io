<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title> Runner </title>
    <meta name="description" content="a game">
    <meta name="viewport" content="width=device-width">
    <meta name="viewport" content="height=device-height">
    <link rel="stylesheet" type="text/css" href="Game.css">
    <script src="jquery-3.1.1.js"></script>
</head>
<script src="enemy.js"></script>
    <script src="gravity.js"></script>
<body>
    <style>
        
    </style>
    <script>
        var sky = 0;
        var stone = 1;
        var gold = 2;
        var player = 3;
        var cloud = 4;
        var ladder = 5;
        var enemyPath = 6;
        
        var i;
        var j;
        //coords of the startingposition of the player
        var CurY = 12;
        var CurX = 0;
        var level = [
   [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
 , [0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
 , [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0]
 , [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 4, 5, 0, 0, 0, 0, 0, 0, 4, 0, 0, 0, 0, 0, 0]
 , [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
 , [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
 , [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
 , [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 1, 1, 1, 1, 1, 1, 5, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
 , [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
 , [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
 , [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
 , [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 7, 0, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
 , [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 11]
 , [0, 0, 0, 2, 0, 0, 0, 0, 0, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 0, 0, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1]
 , [1, 1, 1, 1, 1, 1, 1, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 7, 7, 7, 7]
 , [9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9]];
        
        
        
        
        $(document.body).append('<div id="container"></div>')
        $(document.body).append('<output id="out"></output>')
        $(document.body).append('<div id="PlayerP"></div>')
        $(document.body).append('<div id="EnemyP"></div>')
        Fpsmeter = document.getElementById('out');
        EnemyPos = document.getElementById('EnemyP');
        PlayerPos = document.getElementById('PlayerP');
        var playerObject;
        var score;

        function build() {
           
            $("#container").css("height", level.length * 50 + "px");
            $("#container").css("width", level[0].length * 50 + "px");
            $(document.body).append('<div id="points"></div>')
            score = document.getElementById('points');
            score.style.position = 'fixed'
            score.style.top = '10px'
            score.style.left = '10px'
            score.style.width = '150px'
            score.style.height = '50px'
            score.style.border = 'none'
            score.style.fontSize = '40px'
            score.innerHTML = points;
            Fpsmeter.style.position = 'fixed'
            Fpsmeter.style.left = '10px'
            Fpsmeter.style.top = '60px'
            Fpsmeter.style.fontSize = '20px'
            
            
            
            
            PlayerPos.style.position = 'fixed'
            PlayerPos.style.left = '10px'
            PlayerPos.style.top = '110px'
            PlayerPos.style.fontSize = '20px'
            PlayerPos.style.backgroundColor = 'green'
            
            
            
            checkScore();
            positie();
            
            
            
            
            
            
            for (i = 0; i < level.length; i++) {
                for (j = 0; j < level[0].length; j++) {
                    if (parseInt(level[i][j]) === 0 || parseInt(level[i][j]) === 6) {
                        $('#container').append('<div class="sky"' + [i] + '-' + [j] + '></div>')
                    }
                    else if (parseInt(level[i][j]) === 1) {
                        $('#container').append('<div class="grass"' + [i] + '-' + [j] + '></div>')
                    }
                    else if (parseInt(level[i][j]) === 2) {
                        $('#container').append('<div class="gold"' + [i] + '-' + [j] + '></div>')
                    }
                    else if (parseInt(level[i][j]) === 4) {
                        $('#container').append('<div class="cloud"' + [i] + '-' + [j] + '></div>')
                    }
                    else if (parseInt(level[i][j]) === 5) {
                        $('#container').append('<div class="ladder"' + [i] + '-' + [j] + '></div>')
                    }
                    else if (parseInt(level[i][j]) === 7) {
                        $('#container').append('<div class="rock"' + [i] + '-' + [j] + '></div>')
                    }
                    else if (parseInt(level[i][j]) === 9) {
                        $('#container').append('<div class="void"' + [i] + '-' + [j] + '></div>')
                    }
                    else if (parseInt(level[i][j]) === 11) {
                        $('#container').append('<div class="door"' + [i] + '-' + [j] + '></div>')
                    }
                }
            }
        }
        
        
        playerObject = $('<div class="player"></div>').appendTo('#container');
       
        
        
        
        var points = 0;
        gravityCheck();
        var jumping = false;
        var right = true;
        var moving = false;
        document.onkeydown = checkKey;

        function checkKey(e) {
            e = e || window.event;
            if (e.keyCode == '38') {
                //up
                
                
                
                var temp = parseInt(level[CurY-1][CurX]);
                if (temp === 5) {
                    ladderUp();

                    function ladderUp() {
                        if (parseInt(level[CurY - 1][CurX]) === 5) {
                            CurY--;;
                            positie();
                            playerObject.animate({
                                top: 50 * CurY + "px"
                            }, 150).promise().done(function () {
                                ladderUp();
                                resetMoving();
                            });
                        }
                    }
                }
                else if (moving === false) {
                    if (temp === 0 || temp === 2 || temp === 6 || temp === 4 || temp === 11) {
                       
                        
                        jumping = true;
                        moving = true;
                        CurY--;;
                        positie();
                        playerObject.animate({
                            top: 50 * CurY + "px"
                        }, 100)
                        
                        
                        
                        var temp2 = parseInt(level[CurY][CurX + 1]);
                                             
                        var temp3 = parseInt(level[CurY][CurX - 1]);                    
                                             
                                             
                        if (right && temp2 === 0 || temp2 === 5 || temp2 === 6 || temp2 === 2 || temp === 4 || temp === 11) {
                            
                            CurX++;
                            playerObject.animate({
                                left: 50 * CurX + "px"
                            }, 100).promise().done(function () {
                                resetMoving();
                            });
                        }
                        else if (temp3 === 0 || temp3 === 5 || temp3 === 6 || temp2 === 2 || temp === 4 || temp === 11) {
                            
                            CurX--;
                            playerObject.animate({
                                left: 50 * CurX + "px"
                            }, 100).promise().done(function () {
                                resetMoving();
                            });
                        }
                        checkScore()
                    }
                    jumping = false;
                }
            }
            else if (e.keyCode == '37') {
                right = false;
                //left
                playerObject.css('background-image', 'url(heroL.png)');
                if (moving === false) {
                    var temp = parseInt(level[CurY][CurX - 1]);
                    if (temp === 0 || temp === 2 || temp === 5 || temp === 6 || temp === 4 || temp === 11) {
                        moving = true;
                        CurX--;
                        playerObject.animate({
                            left: 50 * CurX + "px"
                        }, 100).promise().done(function () {
                            resetMoving();
                        });
                        positie();
                        right = false;
                        checkScore()
                    }
                }
            }
            else if (e.keyCode == '39') {
                right = true;
                playerObject.css('background-image', 'url(heroR.png)');
                //right
                if (moving === false) {
                    var temp = parseInt(level[CurY][CurX + 1]);
                    if (temp === 0 || temp === 2 || temp === 5 || temp === 6 || temp === 4 || temp === 11) {
                        moving = true;
                        positie();
                        CurX++;
                        playerObject.animate({
                            left: 50 * CurX + "px"
                        }, 100).promise().done(function () {
                            resetMoving();
                        });
                        right = true;
                        checkScore()
                    }
                }
            }
        }

        function positie() {
            
            score.innerHTML = 'Points: ' + points;
            setTimeout(positie, 100)
            PlayerPos.innerHTML ="speler " + "X: " + CurX + " P.Y: " + CurY
            
            
        }

        function resetMoving() {
            moving = false;
        }

        function checkScore() {
            var pos = parseInt(level[CurY][CurX]);
            if (pos === 2) {
                points++;
                console.log(points);
                
                level[CurY][CurX] = sky;
                $('<div class="gold"' + parseInt([CurY]) + '-' + parseInt([CurX]) + '></div>').css("background-image", "")
                
            }else if(pos === 11){
                $(document.body).remove();
            var newbody = document.createElement("body");
            $("html").append(newbody);
            working = false;
            
           
            
          
            $('body').css('background-image', 'url(win.gif)')
       
          
            
            
            }
                
                
            
        }
        var timer;

        
        var playing = true;

    
        window.onload = function () {
            build();
        }
        window.countFPS = (function () {
            var lastLoop = (new Date()).getMilliseconds();
            var count = 1;
            var fps = 0;
            return function () {
                var currentLoop = (new Date()).getMilliseconds();
                if (lastLoop > currentLoop) {
                    fps = count;
                    count = 1;
                }
                else {
                    count += 1;
                }
                lastLoop = currentLoop;
                return fps;
            };
        }());
        var $out = $('#out');
        (function loop() {
            requestAnimationFrame(function () {
                $out.html('FPS: ' + countFPS());
                loop();
            });
        }());
        
        
        
        
        
    function die(){
        
        if (CurX < level.length) {
            
            alert('game over')
  
}
        
        
    }
    </script>
    
</body>
    

</html>